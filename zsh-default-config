#!/bin/zsh
#
## Copyright 2012 Victor Penso
##
## This program is free software: you can redistribute it and/or modify
## it under the terms of the GNU General Public License as published by
## the Free Software Foundation, either version 3 of the License, or
## (at your option) any later version.
##
## This program is distributed in the hope that it will be useful,
## but WITHOUT ANY WARRANTY; without even the implied warranty of
## MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
## GNU General Public License for more details.
##
## You should have received a copy of the GNU General Public License
## along with this program. If not, see <http://www.gnu.org/licenses/>.
##

mkdir ~/.zsh 2>-

# Antigen package management for zsh plug-ins
ANTIGEN=https://raw.github.com/zsh-users/antigen/master/antigen.zsh
if [ ! -e ~/.zsh/antigen.zsh ] ; then
  curl --silent $ANTIGEN > ~/.zsh/antigen.zsh
  echo "ZSH anitgen installed to ~/.zsh/"
fi

##
## Configuration for ls colors
##
if [ ! -e $HOME/.dircolors/rainbow.colors ] ; then
# make sure parent directory exists
mkdir $HOME/.dircolors 2> /dev/null
# write the colors configuration
cat > $HOME/.dircolors/rainbow.colors <<EOF
TERM screen-256color
RESET                 0
FILE                  00;38;5;241
DIR                   01;38;5;39 
LINK                  00;38;5;221
MULTIHARDLINK         00 
FIFO                  48;5;235;38;5;160 # pipe
SOCK                  48;5;235;38;5;160 
DOOR                  48;5;235;38;5;252 
BLK                   48;5;235;38;5;160 # block device driver
CHR                   48;5;235;38;5;252 # character device driver
ORPHAN                48;5;235;38;5;160 # symlink to nonexistent file, or non-stat'able file
SETUID                38;5;196 # file that is setuid (u+s)
SETGID                38;5;196 # file that is setgid (g+s)
CAPABILITY            30;41 # file with capability
STICKY_OTHER_WRITABLE 04;38;5;27 # dir that is sticky and other-writable (+t,o+w)
OTHER_WRITABLE        00;38;5;196 # dir that is other-writable (o+w) and not sticky
STICKY                38;5;196 # dir with the sticky bit set (+t) and not other-writable
EXEC                  01;38;5;220

.log                  01;38;5;196
.rb                   00;38;5;228
.cpp                  00;38;5;228
.c                    00;38;5;228
.c++                  00;38;5;228
.bash                 00;38;5;228
.sh                   00;38;5;228
.pl                   00;38;5;228
.tex                  01;38;5;245
.torrent              01;38;5;245
*Makefile             01;38;5;202
*Rakefile             01;38;5;202
*build.xml            01;38;5;202
*rc                   00;38;5;208
*1                    01;38;5;245
.md                   01;38;5;255
.markdown             01;38;5;255
.txt                  00;38;5;253
.xhtml                01;38;5;250
.html                 01;38;5;250
*README               00;38;5;196
*README.txt           00;38;5;196
*readme.txt           00;38;5;196
*README.md            00;38;5;196
*README.markdown      00;38;5;196
*yml                  00;38;5;208
*cfg                  00;38;5;208
*conf                 00;38;5;208
EOF
echo "ls colors configuration written to ~/.dircolors/rainbow.colors"
fi

##
## Zsh configuration file
##
if [ -e $HOME/.zshrc ] ; then
echo "Zsh configuration ~/.zshrc exists!"
  exit 0
fi

cat > $HOME/.zshrc <<'EOF'
export ADOTDIR=~/.zsh
source ~/.zsh/antigen.zsh

antigen-bundle git
antigen-bundle oscarschneider/knife-completion

antigen-bundle zsh-users/zsh-syntax-highlighting

ZSH_HIGHLIGHT_HIGHLIGHTERS=(main brackets pattern cursor)
ZSH_HIGHLIGHT_STYLES+=(
  reserved-word          'fg=27,bold'
  command                'fg=27,bold'
  hashed-command         'fg=27,bold'
  alias                  'fg=39,bold'
  builtin                'fg=27,bold'
  function               'fg=39,bold'
  path                   'fg=250,bg=234'
  single-quoted-argument 'fg=220,bold'
  double-quoted-argument 'fg=220,bold'
)

U_AR=$'\u2b80'
U_AL=$'\u2b82'

antigen-bundle olivierverdier/zsh-git-prompt

__GIT_PROMPT_DIR=~/.zsh/repos/https-COLON--SLASH--SLASH-github.com-SLASH-olivierverdier-SLASH-zsh-git-prompt.git/

export __GIT_PROMPT_DIR

ZSH_THEME_GIT_PROMPT_PREFIX="%B%K{232}%F{240}"
ZSH_THEME_GIT_PROMPT_SUFFIX="%K{232}%K{234}%F{232}$U_AR%f%b"
ZSH_THEME_GIT_PROMPT_SEPARATOR=""
ZSH_THEME_GIT_PROMPT_CLEAN=""
ZSH_THEME_GIT_PROMPT_STAGED="%K{232}%F{166}●"
ZSH_THEME_GIT_PROMPT_CONFLICTS="%K{232}%F{166}✖"
ZSH_THEME_GIT_PROMPT_CHANGED="%K{232}%F{26}✚"
ZSH_THEME_GIT_PROMPT_BRANCH="%K{232}%F{240}"
ZSH_THEME_GIT_PROMPT_UNTRACKED="%K{232}%F{166}…"

antigen-apply

PROMPT='$(git_super_status)%K{234}%k%F{234}$U_AR%f '
RPROMPT='%F{236}$U_AL%f%K{236}%F{245} %n %F{233}$U_AL%K{233}%F{245} %~ %k%F{233}$U_AR%f'

autoload -U colors && colors
eval $(dircolors ~/.dircolors/rainbow.colors)

if [ -f $HOME/.zsh_config_hook ]
then
  source $HOME/.zsh_config_hook
fi

export TERM="screen-256color"
EOF
echo "Configuration written to ~/.zshrc"

# make zsh default shell
shell=$(getent passwd $USER | cut -d':' -f 7)
if [ ! "$shell" = "/bin/zsh" ] ; then
  chsh -s /bin/zsh
  echo "Re-login to your user account."
fi
